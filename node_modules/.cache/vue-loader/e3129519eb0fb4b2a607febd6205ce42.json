{"remainingRequest":"/Users/zhuyuqing/Desktop/mall/vue-shop-master-2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhuyuqing/Desktop/mall/vue-shop-master-2/src/views/detail/ProductDetail.vue?vue&type=style&index=0&id=a9de3248&scoped=true&lang=css&","dependencies":[{"path":"/Users/zhuyuqing/Desktop/mall/vue-shop-master-2/src/views/detail/ProductDetail.vue","mtime":1585591998000},{"path":"/Users/zhuyuqing/Desktop/mall/vue-shop-master-2/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhuyuqing/Desktop/mall/vue-shop-master-2/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/zhuyuqing/Desktop/mall/vue-shop-master-2/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/zhuyuqing/Desktop/mall/vue-shop-master-2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhuyuqing/Desktop/mall/vue-shop-master-2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5wcm9kdWN0LWRldGFpbCB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwp9CgovKiBCU2Nyb2xs5Zu65a6a6auY5bqm5ZKM5Yy65Z+fICovCi5zY3JvbGwtaGVpZ2h0IHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiA0NHB4OwogIHJpZ2h0OiAwOwogIGJvdHRvbTogNTBweDsKICBsZWZ0OiAwOwogIG92ZXJmbG93OiBoaWRkZW47CiAgd2lkdGg6IDEwMCU7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjsKfQoKLyogdnVl55qE5reh5YWl5reh5Ye65Yqo55S7ICovCi5zY3JvbGwtZW50ZXItYWN0aXZlLAouc2Nyb2xsLWxlYXZlLWFjdGl2ZSB7CiAgdHJhbnNpdGlvbjogYWxsIDAuM3M7Cn0KCi5zY3JvbGwtZW50ZXIsCi5zY3JvbGwtbGVhdmUtdG8gewogIG9wYWNpdHk6IDA7Cn0KCi5zY3JvbGwtZW50ZXItdG8sCi5zY3JvbGwtbGVhdmUgewogIG9wYWNpdHk6IDE7Cn0K"},{"version":3,"sources":["ProductDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwLA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"ProductDetail.vue","sourceRoot":"src/views/detail","sourcesContent":["<template>\n  <div class=\"product-detail\">\n    <product-detail-nav-bar @titleItemClick=\"titleItemClick\" ref=\"detailNavBar\" />\n    <scroll :probe-type=\"3\" @backTopScroll=\"detailScroll\" class=\"scroll-height\" ref=\"scroll\">\n      <detail-swiper :swiper-list=\"topImages\" class=\"detail-set-scroll\" />\n      <detail-base-info :goods=\"goods\" />\n      <detail-shop-info :shop=\"shops\" />\n      <detail-images-info :images-info=\"detailsInfo\" @imgLoad=\"imgLoad\" />\n      <detail-param-info :param-info=\"paramsInfo\" class=\"detail-set-scroll\" />\n      <detail-comment-info :comment-info=\"commentInfo\" class=\"detail-set-scroll\" />\n      <goods-list :goods=\"recommendList\" :is-recommend=\"true\" class=\"detail-set-scroll\" />\n    </scroll>\n\n    <!-- 回到顶部,监听组件的原生事件必须要用native修饰符变成原生组件 -->\n    <transition name=\"scroll\">\n      <back-top @click.native=\"backTop\" v-show=\"curPosition >= 1500\" />\n    </transition>\n\n    <detail-bottom-bar @addToCart=\"addToCart\" />\n  </div>\n</template>\n\n<script>\nimport ProductDetailNavBar from \"./children/ProductDetailNavBar\";\nimport DetailSwiper from \"./children/DetailSwiper\";\nimport DetailBaseInfo from \"./children/DetailBaseInfo\";\nimport DetailShopInfo from \"./children/DetailShopInfo\";\nimport Scroll from \"@/components/common/scroll/Scroll\";\nimport DetailImagesInfo from \"./children/DetailImagesInfo\";\nimport DetailParamInfo from \"./children/DetailParamInfo\";\nimport DetailCommentInfo from \"./children/DetailCommentInfo\";\nimport GoodsList from \"@/components/content/goods/GoodsList\";\nimport DetailBottomBar from \"./children/DetailBottomBar\";\nimport BackTop from \"@/components/content/backTop/BackTop\";\n\nimport { getProductDetail, getRecommend, Goods, GoodsParams, Shop } from \"@/network/productDetail\";\nimport { backTopMixin, imgListenerMixin } from \"@/common/mixin\";\n\nexport default {\n  name: \"ProductDetail\",\n  data() {\n    return {\n      detailId: \"\",\n      // 轮播图数据\n      topImages: [],\n      goods: {},\n      shops: {},\n      detailsInfo: {},\n      paramsInfo: {},\n      commentInfo: {},\n      recommendList: [],\n      detailClassList: [],\n      detailIndex: 0\n    };\n  },\n  mixins: [imgListenerMixin, backTopMixin],\n  components: {\n    DetailBottomBar,\n    GoodsList,\n    DetailCommentInfo,\n    DetailParamInfo,\n    DetailImagesInfo,\n    Scroll,\n    DetailShopInfo,\n    DetailBaseInfo,\n    DetailSwiper,\n    ProductDetailNavBar,\n    BackTop\n  },\n  beforeCreate() {\n    // 进入详情页隐藏tabBar\n    this.$store.commit(\"setTabBarShow\", false);\n  },\n  created() {\n    // 获取页面传过来的id\n    this.detailId = this.$route.params.id;\n\n    // 发送网络请求\n    this.getProductDetail();\n    this.getRecommend();\n  },\n  // 路由离开的时候恢复tabBar\n  beforeRouteLeave(to, from, next) {\n    this.$store.commit(\"setTabBarShow\", true);\n    next();\n  },\n  destroyed() {\n    // 取消detail组件事件总线的监听\n    this.$bus.$off(\"imgLoad\", this.imgListener);\n  },\n  methods: {\n    // 请求详情数据\n    getProductDetail() {\n      getProductDetail(this.detailId).then(res => {\n        const data = res.result;\n        // console.log(data);\n\n        // 获取轮播图数据\n        this.topImages = data.itemInfo.topImages;\n\n        // 获取商品数据,调用封装的ES6的class\n        this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services);\n\n        // 获取店铺数据\n        this.shops = new Shop(data.shopInfo);\n\n        // 获取下面的图片展示数据\n        this.detailsInfo = data.detailInfo;\n\n        // 获取尺寸数据\n        this.paramsInfo = new GoodsParams(data.itemParams.info, data.itemParams.rule || {});\n\n        // 获取评论数据\n        if (data.rate.cRate !== 0) {\n          this.commentInfo = data.rate.list[0] || {};\n        }\n      });\n    },\n    // 请求推荐数据\n    getRecommend() {\n      getRecommend().then(res => {\n        // console.log(res);\n        this.recommendList = res.data.list;\n      });\n    },\n    imgLoad() {\n      this.$refs.scroll.refresh();\n      // 图片加载完获取classList\n      this.getClassList();\n    },\n    // navBar点击\n    titleItemClick(index) {\n      // 根据数组下标滚动到对应的元素内容位置\n      this.$nextTick(() => {\n        let el = document.getElementsByClassName(\"detail-set-scroll\");\n        this.$refs.scroll.scrollToElement(el[index], 300);\n      });\n    },\n    // 获取classList\n    getClassList() {\n      // Array.from() 将伪数组转换成纯数组\n      this.detailClassList = [];\n      this.detailClassList = Array.from(document.getElementsByClassName(\"detail-set-scroll\"));\n      let maxValue = 10000000;\n      this.detailClassList.push({ offsetTop: maxValue });\n      console.log(this.detailClassList);\n    },\n    // 监听详情页滚动事件,并动态设置navBar的index\n    detailScroll(position) {\n      let detailPosition = position ? -position.y : 0;\n      this.curPosition = detailPosition;\n\n      for (let i = 0; i < this.detailClassList.length - 1; i++) {\n        if (\n          detailPosition >= this.detailClassList[i].offsetTop &&\n          detailPosition < this.detailClassList[i + 1].offsetTop\n        ) {\n          if (this.detailIndex !== i) {\n            this.detailIndex = i;\n            this.$refs.detailNavBar.currentIndex = this.detailIndex;\n          }\n          break;\n        }\n      }\n    },\n    // 添加购物车\n    addToCart() {\n      // 1.获取需要展示到购物车的商品信息\n      const obj = {\n        image: this.topImages[0],\n        title: this.goods.title,\n        desc: this.goods.desc,\n        price: this.goods.lowNowPrice,\n        id: this.detailId\n      };\n\n      // 2.将商品数据传到购物车页面\n      this.$store.dispatch(\"setCateGoryData\", obj);\n    }\n  }\n};\n</script>\n\n<style scoped>\n.product-detail {\n  width: 100%;\n  height: 100%;\n}\n\n/* BScroll固定高度和区域 */\n.scroll-height {\n  position: absolute;\n  top: 44px;\n  right: 0;\n  bottom: 50px;\n  left: 0;\n  overflow: hidden;\n  width: 100%;\n  background-color: #ffffff;\n}\n\n/* vue的淡入淡出动画 */\n.scroll-enter-active,\n.scroll-leave-active {\n  transition: all 0.3s;\n}\n\n.scroll-enter,\n.scroll-leave-to {\n  opacity: 0;\n}\n\n.scroll-enter-to,\n.scroll-leave {\n  opacity: 1;\n}\n</style>\n"]}]}